<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Události - Jdeme Hrát</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
</head>
<body class="bg-gray-100">

<!-- Top navigation bar -->
<header class="bg-white shadow py-4 px-6 flex justify-between items-center">
    <div class="text-3xl font-bold text-gray-800">Jdeme Hrát</div>
    <div class="text-gray-800" id="usernameDisplay">{{ user.username }}</div>
</header>

<div class="flex flex-col md:flex-row">

    <!-- Sidebar -->
    <aside class="md:w-64 bg-black text-white flex-shrink-0 p-6 space-y-6 min-h-screen">
        <a href="/" class="flex items-center space-x-2">
            <i class="fas fa-home"></i>
            <span>Domů</span>
        </a>
        <a href="#" class="flex items-center space-x-2" id="showCreateEventModal">
            <i class="fas fa-plus-circle"></i>
            <span>Vytvořit novou událost</span>
        </a>
        <!-- další odkazy -->
    </aside>

    <!-- Main content -->
    <main class="flex-1 p-6">
        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6" id="eventsContainer">
            <!-- Místo pro dlaždice událostí -->
        </div>
    </main>
</div>

<!-- Modal Form for Creating Event -->
<div id="createEventModal" class="hidden fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full" id="my-modal">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3 text-center">
      <h3 class="text-lg leading-6 font-medium text-gray-900">Vytvoření události</h3>
      <form id="createEventForm" class="bg-white rounded px-8 pt-6 pb-8 mb-4">
        <input class="mt-2 border rounded px-2 py-1 w-full" type="text" name="nazev" placeholder="Název">
        <textarea class="mt-2 border rounded px-2 py-1 w-full" name="popis" placeholder="Popis"></textarea>
        <input class="mt-2 border rounded px-2 py-1 w-full" type="text" name="hra" placeholder="Hra">
        <input class="mt-2 border rounded px-2 py-1 w-full" type="text" name="misto" placeholder="Místo">
        <input class="mt-2 border rounded px-2 py-1 w-full" type="datetime-local" name="datum_konani">
        <button class="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-700" type="submit">Vytvořit</button>
        <button class="mt-4 px-4 py-2 bg-gray-500 text-white rounded hover:bg-gray-700" type="button" id="closeCreateEventModal">Zavřít</button>
      </form>
    </div>
  </div>
</div>

<script>
// Funkce pro získání CSRF tokenu
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const csrftoken = getCookie('csrftoken');

// Funkce pro zobrazení modálního okna pro vytvoření události
document.getElementById('showCreateEventModal').addEventListener('click', () => {
    document.getElementById('createEventModal').classList.remove('hidden');
});

// Funkce pro skrytí modálního okna pro vytvoření události
document.getElementById('closeCreateEventModal').addEventListener('click', () => {
    document.getElementById('createEventModal').classList.add('hidden');
});

function loadEvents() {
    fetch('/api/events/') // Nastavte URL pro váš API endpoint
    .then(response => response.json())
    .then(events => {
        const eventsContainer = document.getElementById('eventsContainer');
        eventsContainer.innerHTML = ''; // Vymažeme stávající obsah
        events.forEach(event => {
            // Vytvoření a přidání dlaždice události do kontejneru
            const eventTile = document.createElement('div');
            eventTile.className = 'bg-white p-4 rounded-lg shadow-md';
            eventTile.innerHTML = `
                <div class="bg-cover bg-center h-32" style="background-image: url('${event.image_url}');"></div>
                <h3 class="text-lg font-semibold mt-2">${event.nazev}</h3>
                <p class="text-gray-600">${event.datum_konani} v ${event.misto}</p>
            `;
            eventsContainer.prepend(eventTile); // Přidáme dlaždici na začátek, aby nejnovější byly nahoře
        });
    })
    .catch(error => {
        console.error('Nastala chyba při načítání událostí:', error);
    });
}

// Event listener pro odeslání formuláře a vytvoření události
document.getElementById('createEventForm').addEventListener('submit', function(event) {
    event.preventDefault();
    let formData = new FormData(event.target);

    fetch('/api/events/', {
        method: 'POST',
        headers: {
            'X-CSRFToken': csrftoken,
        },
        body: formData
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Network response was not ok ' + response.statusText);
        }
        return response.json();
    })
    .then(data => {
        loadEvents(); // Načtení všech událostí včetně nové
        document.getElementById('createEventModal').classList.add('hidden'); // Skrytí modálního okna
    })
    .catch(error => {
        console.error('Error:', error);
    });
});

// Inicializace stránky načtením událostí
loadEvents();
</script>

</body>
</html>
